# ML & API Models

This section documents the **machine learning logic** and the **Pydantic models** used by the FastAPI backend.  
These models define how bundle recommendations are calculated, validated, and returned to the Streamlit application.

The system uses **association rule mining** to identify meaningful product bundles based on user-adjustable thresholds.

---

# ðŸ¤– Machine Learning Model â€“ Bundle Recommendation Engine

The ML logic is implemented in the FastAPI backend. It analyzes **transactionâ€“product co-occurrence** to compute:

- **Support**  
- **Confidence**  
- **Lift**  
- **Success Probability** (custom metric)  

These metrics determine whether a product pair qualifies as a *recommended bundle*.

---

# ðŸ§  Core Concepts

## ðŸ”¹ Support
**How often the products appear together.**

\[
Support(A,B) = \frac{\text{Transactions containing both A and B}}{\text{Total transactions}}
\]

Higher support â†’ more popular bundle.

---

## ðŸ”¹ Confidence
**How likely a customer buys B after buying A.**

\[
Confidence(A \rightarrow B) = \frac{Support(A,B)}{Support(A)}
\]

Higher confidence â†’ stronger dependency.

---

## ðŸ”¹ Lift
Lift measures the strength of a bundle relative to random chance.

\[
Lift(A,B) = \frac{Confidence(A \rightarrow B)}{Support(B)}
\]

Lift > 1 â†’ meaningful association  
Lift < 1 â†’ negative association  
Lift â‰« 1 â†’ excellent bundle candidate  

---

## ðŸ”¹ Success Probability (Custom Metric)

This project introduces a **marketing-friendly probability score**, scaled from **0 to 1**, combining:

- Normalized confidence  
- Normalized lift  
- Historical performance  
- Product category weights  

Example formula (simplified):

```python
success_probability = 0.6 * confidence + 0.4 * min(lift / 3, 1)
```

This makes results easier to interpret in Streamlit.

---

# ðŸ§® Bundle Model (Internal Logic)

Inside the API service, bundles are structured as Python objects:

```python
class Bundle(BaseModel):
    products: list[str]
    support: float
    confidence: float
    lift: float
    success_probability: float
    popularity: float
```

These values are calculated by scanning:

- product frequencies  
- pair co-occurrences  
- conditional probabilities  

The algorithm runs efficiently on ~2,500 transactions generated by your ETL.

---

# ðŸ“¦ Pydantic API Models

Pydantic models ensure that:

- API requests are validated  
- API responses are structured  
- Errors are returned in a predictable format  

These models live inside:

```
myapp/api/models/
```

---

## ðŸ“˜ BundleRequest Model

Used by the Streamlit app to request bundle recommendations.

```python
class BundleRequest(BaseModel):
    min_support: float
    min_confidence: float
    max_results: int = 10
```

### Example Request
```json
{
  "min_support": 0.01,
  "min_confidence": 0.2,
  "max_results": 10
}
```

---

## ðŸ“— BundleResponse Model

Used to send bundle results back to the UI.

```python
class BundleResponse(BaseModel):
    products: list[str]
    support: float
    confidence: float
    lift: float
    success_probability: float
    popularity: float
```

### Example Response
```json
{
  "products": ["Shampoo", "Conditioner"],
  "support": 0.18,
  "confidence": 0.62,
  "lift": 2.4,
  "success_probability": 0.73,
  "popularity": 0.21
}
```

---

## ðŸ“™ CampaignModel

Used when creating a campaign via `/campaigns` endpoint.

```python
class CampaignModel(BaseModel):
    bundle: list[str]
    discount_type: str
    discount_value: float
    minimum_order_price: float
    channel: str
    budget: float
    segment (optional)

Currently, segmentation logic is **not implemented** in the backend.  
The field exists in the UI for demonstration purposes, but the API treats it as a simple text value without internal logic.

```

# ðŸ›  Behind the Bundle Engine

The ML engine performs:

### 1ï¸âƒ£ Frequency Calculation  
Counts how often each product is bought.

### 2ï¸âƒ£ Co-Occurrence Matrix  
Counts product pairs appearing in the same transaction.

### 3ï¸âƒ£ Probability Computation  
Support and confidence are computed from the above.

### 4ï¸âƒ£ Lift Calculation  
Strength of association beyond randomness.

### 5ï¸âƒ£ Filtering  
Pairs below the thresholds are removed.

### 6ï¸âƒ£ Ranking  
Bundles are sorted by:

- success_probability  
- support  
- confidence  
- lift  

This ensures meaningful bundles appear first.

---

# ðŸ“Š Example of Internal Calculation

For bundle: **Shampoo â†’ Conditioner**

| Metric | Value |
|--------|--------|
| Support | 0.18 |
| Confidence | 0.62 |
| Lift | 2.40 |
| Popularity | 0.21 |
| Success Probability | 0.73 |

These values are derived directly from the transaction dataset.

---

# ðŸ§© Relationship Between API & ML Models

```
Streamlit â†’ BundleRequest â†’ FastAPI â†’ ML Engine
                                 â†“
                          BundleResponse
                                 â†“
                             Streamlit UI
```

The ML engine sits *inside* the API layer, making it:

- modular  
- testable  
- easy to expand (e.g., multi-item bundles, segmentation-based bundles)  

---
# ðŸ”® Future Improvements

The current system focuses on bundle generation, dashboards, and campaign creation.  
Several enhancements can expand its intelligence and realism:

### ðŸ“Œ Customer Segmentation (Not Yet Implemented)
Introduce **data-driven segmentation**, such as:
- RFM scoring (Recencyâ€“Frequencyâ€“Monetary)
- Behavioral clustering (k-means, GMM)
- High-value / at-risk customer detection
- Segment-specific product affinities

This would allow campaigns to be **automatically targeted** based on customer behavior rather than manual selection.

### ðŸ“Œ Multi-Item Bundles
Extend the association-rule mining to support:
- 3-item bundles (A + B + C)
- Replacement rules (Customers who buy A often buy B instead of C)

### ðŸ“Œ Category-Based Bundle Generation
Allow the ML engine to:
- Recommend bundles per product category (Skincare, Hair Care, Makeup)
- Identify cross-category synergies (e.g., Fragrance + Body Lotion)

### ðŸ“Œ Price Elasticity Modeling
Estimate:
- How discount levels affect purchase probability
- Optimal discount percentage for maximizing revenue

### ðŸ“Œ Personalized Recommendations
Generate bundles based on:
- Individual buying history
- Customer lifetime value
- Customer preferences inferred from transaction patterns

### ðŸ“Œ Promotion Uplift Prediction
Using historical campaign data, forecast:
- Expected uplift (sales increase)
- Campaign ROI
- Customer response likelihood

---

# ðŸŽ‰ Summary

The API models and ML engine together provide the intelligence of the system:

- Pydantic ensures clean, structured communication  
- Association rule mining powers the bundle logic  
- Metrics (support, confidence, lift) quantify the strength of each recommendation  
- Success probability adds marketing relevance  

This layer transforms raw transaction data into actionable retail insights.

